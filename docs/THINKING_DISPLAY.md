# 思维链显示功能使用指南

## 📖 功能简介

思维链显示功能允许用户控制是否在回复中看到 AI 的思考过程。这对教学场景特别有用，可以让学生理解 AI 如何分析和解决问题。

---

## 🎯 功能特点

- ✅ **动态切换**：无需重启服务，随时切换显示状态
- ✅ **教学友好**：帮助学生理解问题分析思路
- ✅ **快速响应**：关闭后直接给出答案，节省时间
- ✅ **灵活控制**：通过工具调用或配置文件控制

---

## 🚀 使用方法

### 方式1：通过工具调用（推荐）

#### 查看当前状态

```
用户：查看当前思维链显示状态
```

AI 会调用 `get_thinking_status` 工具，返回当前状态信息。

#### 切换显示状态

```
用户：开启思维链显示
```
或
```
用户：关闭思维链显示
```

AI 会调用 `toggle_thinking_display` 工具，切换显示状态。

---

### 方式2：通过配置文件

编辑 `config/agent_llm_config.json` 文件：

```json
{
  "config": {
    "show_thinking": true  // true 表示开启，false 表示关闭
  }
}
```

修改后需要重启服务才能生效。

---

## 📊 显示效果对比

### 关闭思维链显示（默认）

**用户输入：**
```
解释牛顿第二定律
```

**AI 回复：**
```
牛顿第二定律（Newton's Second Law）是经典力学的核心定律之一。

**公式：** F = ma

**物理含义：**
- F（力）：物体所受的合外力，单位是牛顿（N）
- m（质量）：物体的质量，单位是千克（kg）
- a（加速度）：物体的加速度，单位是米每二次方秒（m/s²）

**定律内容：**
物体的加速度与所受的合外力成正比，与物体的质量成反比，加速度的方向与合外力的方向相同。

**应用举例：**
1. 推车：你用力推一辆车，车会加速。力越大，加速度越大；车越重（质量越大），加速度越小。
2. 踢球：踢足球时，踢得越用力（力越大），球飞得越快（加速度越大）。

**学习建议：**
理解这个定律的关键是记住：力改变运动状态，质量抵抗运动状态的改变。
```

---

### 开启思维链显示

**用户输入：**
```
开启思维链显示
```

**AI 回复：**
```
✅ 思维链显示状态已切换：已开启
```

**用户输入：**
```
解释牛顿第二定律
```

**AI 回复：**
```
💭 思考过程：
1. **分析用户需求**：用户想了解牛顿第二定律的内容、公式和应用
2. **确定处理方案**：
   - 核心知识点：公式 F = ma
   - 物理含义：解释每个变量
   - 实际应用：举生活中的例子
   - 不需要调用外部工具，直接基于知识库回答
3. **执行步骤**：
   - 陈述定律内容和公式
   - 解释各变量含义
   - 提供实际例子
   - 给出学习建议
4. **预期结果**：用户能理解定律内容、公式和应用

---

**回答：**

牛顿第二定律（Newton's Second Law）是经典力学的核心定律之一。

**公式：** F = ma

**物理含义：**
- F（力）：物体所受的合外力，单位是牛顿（N）
- m（质量）：物体的质量，单位是千克（kg）
- a（加速度）：物体的加速度，单位是米每二次方秒（m/s²）

**定律内容：**
物体的加速度与所受的合外力成正比，与物体的质量成反比，加速度的方向与合外力的方向相同。

**应用举例：**
1. 推车：你用力推一辆车，车会加速。力越大，加速度越大；车越重（质量越大），加速度越小。
2. 踢球：踢足球时，踢得越用力（力越大），球飞得越快（加速度越大）。

**学习建议：**
理解这个定律的关键是记住：力改变运动状态，质量抵抗运动状态的改变。
```

---

## 🎓 使用场景建议

### 教学场景（建议开启）

- **课堂教学**：向学生展示 AI 的分析思路
- **问题辅导**：帮助学生理解解题步骤
- **逻辑训练**：培养学生的分析能力
- **学习示范**：展示如何拆解复杂问题

### 快速问答场景（建议关闭）

- **作业检查**：快速获取答案
- **概念查询**：直接获取定义
- **简单计算**：快速得到结果
- **资料查询**：直接获取信息

### 问题排查场景（建议开启）

- **调试分析**：理解 AI 的处理逻辑
- **错误诊断**：找出问题所在
- **效果优化**：分析输出结果

---

## 🛠️ API 调用示例

### 获取状态

```python
from tools.thinking_display_tool import get_thinking_status

status = get_thinking_status()
print(status)
```

**输出示例：**
```
📊 当前思维链显示状态：**已关闭**

**功能说明：**
- **开启时**：回复前会展示 💭 思考过程，包括问题分析、工具选择等步骤
- **关闭时**：直接给出最终答案，不展示思考过程

**使用场景：**
- 📚 教学场景：建议开启，帮助学生理解分析思路
- ⚡ 快速问答：建议关闭，直接获取答案
- 🔧 问题排查：建议开启，便于理解AI的处理逻辑

**操作：**
- 调用 `toggle_thinking_display` 工具可以切换显示状态
```

### 切换状态

```python
from tools.thinking_display_tool import toggle_thinking_display

result = toggle_thinking_display()
print(result)
```

**输出示例：**
```
✅ 思维链显示状态已切换：已开启

**当前配置：**
- 当开启时：回复前会先展示思考过程，帮助理解AI的分析思路
- 当关闭时：直接给出最终答案，适合快速问答

**提示：**
- 教学场景建议开启，让学生学习分析思路
- 快速问答场景建议关闭，直接获取答案

如需再次切换，请调用此工具。
```

### 检查状态

```python
from tools.thinking_display_tool import is_thinking_enabled

enabled = is_thinking_enabled()
print(f"思维链显示状态：{'已开启' if enabled else '已关闭'}")
```

---

## ⚙️ 配置说明

### 配置文件设置

编辑 `config/agent_llm_config.json`：

```json
{
  "config": {
    "temperature": 0.7,
    "show_thinking": false,  // 控制思维链显示
    "thinking_type": "enabled"
  }
}
```

### 配置项说明

| 配置项 | 类型 | 说明 |
|--------|------|------|
| `show_thinking` | Boolean | 控制思维链显示，true=开启，false=关闭 |
| `thinking_type` | String | AI 内部思考能力，enabled=启用 |

**注意**：
- `show_thinking` 控制是否**显示**思考过程给用户
- `thinking_type` 控制 AI 是否**使用**思考能力
- 两者可以独立配置

---

## 💡 最佳实践

1. **教学场景**：开启思维链显示，让学生学习 AI 的分析思路
2. **快速问答**：关闭思维链显示，直接获取答案
3. **复杂问题**：开启思维链显示，帮助理解分析过程
4. **简单查询**：关闭思维链显示，节省时间
5. **定期切换**：根据不同任务需求灵活调整

---

## ❓ 常见问题

### Q1: 思维链显示会影响响应速度吗？

A: 不会。AI 的思考过程在后台进行，开启/关闭只是控制是否显示给用户。

### Q2: 修改配置文件后需要重启服务吗？

A: 如果通过工具调用切换，不需要重启；如果修改配置文件，需要重启服务。

### Q3: 思维链显示会暴露敏感信息吗？

A: 不会。思考过程只包含问题分析、工具选择等信息，不包含用户隐私或敏感数据。

### Q4: 可以为不同用户设置不同的思维链显示状态吗？

A: 当前版本是全局设置，所有用户共享同一状态。如需个性化设置，需要扩展功能。

### Q5: 思维链显示的内容可以被复制吗？

A: 可以。显示的思考过程是纯文本，可以像其他内容一样复制。

---

## 🔧 技术实现

### 工具文件

- `src/tools/thinking_display_tool.py`：思维链显示控制工具

### 核心函数

- `toggle_thinking_display()`：切换显示状态
- `get_thinking_status()`：获取当前状态
- `is_thinking_enabled()`：检查是否开启
- `get_thinking_prompt()`：获取提示信息

### 集成位置

- `src/agents/agent.py`：Agent 集成
- `config/agent_llm_config.json`：配置文件

---

## 📝 更新日志

### v1.0.0 (2025-01-19)
- ✅ 添加思维链显示开关功能
- ✅ 实现动态切换工具
- ✅ 添加配置文件支持
- ✅ 完善使用文档

---

## 📞 获取帮助

如有问题或建议，请：
- 提交 Issue：https://github.com/wuyifan-code/EduGenius-AI-/issues
- 查看文档：https://github.com/wuyifan-code/EduGenius-AI-/docs
